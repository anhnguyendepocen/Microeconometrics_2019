<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Session I - Quantile regression | Microeconometrics - e-Notes: Practice guide using R</title>
  <meta name="description" content="This course notes are an interactive e-material for the Microeconometrics course in the master APE in Paris School of Economics. The aim of this notes is to provide an e-learning material to apply the theorical concepts of the class." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Session I - Quantile regression | Microeconometrics - e-Notes: Practice guide using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This course notes are an interactive e-material for the Microeconometrics course in the master APE in Paris School of Economics. The aim of this notes is to provide an e-learning material to apply the theorical concepts of the class." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Session I - Quantile regression | Microeconometrics - e-Notes: Practice guide using R" />
  
  <meta name="twitter:description" content="This course notes are an interactive e-material for the Microeconometrics course in the master APE in Paris School of Economics. The aim of this notes is to provide an e-learning material to apply the theorical concepts of the class." />
  

<meta name="author" content="Jaime MONTANA" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script async defer src="https://hypothes.is/embed.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZRYRM10F86"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZRYRM10F86');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Microeconometrics - Practice guide using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#general-info"><i class="fa fa-check"></i><b>1.1</b> General Info</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#contact-information"><i class="fa fa-check"></i><b>1.1.1</b> Contact information</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.2</b> Objective</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>1.3</b> Prerequisites</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-structure"><i class="fa fa-check"></i><b>1.4</b> Course structure</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html"><i class="fa fa-check"></i><b>2</b> Session I - Quantile regression</a><ul>
<li class="chapter" data-level="2.1" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#objective-1"><i class="fa fa-check"></i><b>2.1</b> Objective</a></li>
<li class="chapter" data-level="2.2" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#quantile-regression"><i class="fa fa-check"></i><b>2.2</b> Quantile Regression</a><ul>
<li class="chapter" data-level="2.2.1" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#geometric-interpretation"><i class="fa fa-check"></i><b>2.2.1</b> Geometric interpretation</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#replication-of-a-paper-using-quantile-regression"><i class="fa fa-check"></i><b>2.3</b> Replication of a paper using quantile regression</a><ul>
<li class="chapter" data-level="2.3.1" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#quantile-regression-visualization"><i class="fa fa-check"></i><b>2.3.1</b> Quantile Regression visualization</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#exercises"><i class="fa fa-check"></i><b>2.4</b> Exercises</a><ul>
<li class="chapter" data-level="2.4.1" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#proposed-exercise-1"><i class="fa fa-check"></i><b>2.4.1</b> Proposed exercise 1</a></li>
<li class="chapter" data-level="2.4.2" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#proposed-exercise-2"><i class="fa fa-check"></i><b>2.4.2</b> Proposed exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#more-on-quantiles"><i class="fa fa-check"></i><b>2.5</b> More on quantiles</a></li>
<li class="chapter" data-level="2.6" data-path="session-i-quantile-regression.html"><a href="session-i-quantile-regression.html#references"><i class="fa fa-check"></i><b>2.6</b> References</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Microeconometrics - e-Notes: Practice guide using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="session-i---quantile-regression" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Session I - Quantile regression</h1>
<p><img src="images/1200px-Logo_pse_petit.png" width="90%" style="display: block; margin: auto;" /></p>
<div id="objective-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Objective</h2>
<p>This first class is to introduce your to using R for implementing quantile regressions. Therefore, we are going to:</p>
<ol style="list-style-type: decimal">
<li>Understand the mathematical procedure behind the QR estmation and its computation (both for the estimates and for the the standard errors). This will help understanding the interpretation of the results obtained when applying the procedure in other contexts.</li>
<li><p>Reproduce a paper’s tables and results using quantile regression</p>
<pre><code>a) Import the data
b) Clean the data
c) Reproduce the summary statistics table
d) reproduce the regressions tables</code></pre></li>
<li>Interpret the results</li>
<li><p>Ways to communicate the results (plotting in R)</p></li>
</ol>
<p>In the last part of the lecture I will just mention and make reference to other classes of QR estimators so you can investigate more on them;</p>
</div>
<div id="quantile-regression" class="section level2">
<h2><span class="header-section-number">2.2</span> Quantile Regression</h2>
<p><strong>For a summary on what is the intuition and objective of quantile regression check the article “Quantile Regression” <span class="citation">(Koenker and Hallock 2001)</span>.</strong></p>
<p>QR is a method that allows you to analyse the relation between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> across the <span class="math inline">\(y\)</span> distribution. It is useful when the researcher thinks there are <em>heterogeneous effects</em> at different values of the indipendent variable. It is important to remark that the heterogeneity is on the <strong>outcome</strong> <span class="math inline">\(y\)</span>. Also, it is widely used in presence of outliers and extreme events (infinite variance), for OLS is inconsistent in such cases while the median is always defined and consistent. For quantiles other than <span class="math inline">\(\tau = 0.5\)</span> the estimation is robust, too.</p>
<p>From the class we know the relationship between the <strong>definition of the estimator</strong>, the <strong>risk function</strong> used in the optimization (in the case of the lector the <em>‘LAD function’</em>, when <span class="math inline">\(\tau = 0.5\)</span>) and that we need to solve numerically the <strong>optimization program</strong> in order to identify the parameters of interest. Accordingly, we will explain how the algorithm works and we are going to perform the numerical optimization by hand from the simplest case to more complex problems.</p>
<div id="geometric-interpretation" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Geometric interpretation</h3>
<p>From <span class="citation">(Koenker and Hallock 2001)</span>:</p>
<blockquote>
<p>Quantiles seem inseparably linked to the operations of ordering and sorting the sample observations that are usually used to define them. So it comes as a mild surprise to observe that we can define <strong>the quantiles</strong> through a simple alternative expedient <strong>as an optimization problem</strong>. Just as we can define the sample mean as the solution to the problem of minimizing a sum of squared residuals, we can define the <em>median as the solution to the problem of minimizing a sum of absolute residuals</em>. The symmetry of the piecewise linear absolute value function implies that the minimization of the sum of absolute residuals must equate the number of positive and negative residuals, thus assuring that there are the same number of observations above and below the median. What about the other quantiles? Since the symmetry of the absolute value yields the median, perhaps minimizing a sum of asymmetrically weighted absolute residuals—simply giving differing weights to positive and negative residuals—would yield the quantiles. This is indeed the case.</p>
</blockquote>
<p>The slope of the coefficient is dividing the error space in two parts according to the desired proportion. It is important to notice that we are considering the error space, we are referring to the conditioning quantile. The difference with the OLS is then clear since the two processes are not comparable. While OLS might provide causal linkages, this is prevented in QR precisely for this reason.</p>
<p>Let’s generate some data to see how the line bisects the error space. Since we are generating random data the first thing is to set a seed so our example is reproducible. Then, we generate variance for our error term (not constant) and set an intercept and define the slope. We set everything in a ‘data.frame’ objecto to plot it using the package ‘ggplot2’<span class="citation">(Wickham et al. 2019)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">464</span>)
npoints &lt;-<span class="st"> </span><span class="dv">150</span>
x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dt">length.out =</span> npoints)        
sigma &lt;-<span class="st"> </span><span class="fl">0.1</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span><span class="op">*</span><span class="kw">sqrt</span>(x) <span class="op">+</span><span class="st"> </span><span class="kw">ifelse</span>(x<span class="op">&gt;</span><span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">0</span>)                    
intercept &lt;-<span class="st"> </span><span class="dv">2</span>                                
slope &lt;-<span class="st"> </span><span class="fl">0.2</span>                              
                             
error &lt;-<span class="st"> </span><span class="kw">rnorm</span>(npoints,<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma)      
y &lt;-<span class="st"> </span>intercept <span class="op">+</span><span class="st"> </span>slope<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>error                    
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x,y)</code></pre></div>
<p>Let’s plot our synthetic data. We are going to plot the line crossing the 90th percentile conditioning on <span class="math inline">\(X\)</span> (dashed red line), the OLS curve (blue line with confidence intervals in grey) and the LAD regression (regression to the median, <span class="math inline">\(\tau = 0.5\)</span>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(x,y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">geom_quantile</span>(<span class="dt">quantiles =</span> <span class="fl">0.9</span>, <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">linetype=</span><span class="st">&quot;dotted&quot;</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_quantile</span>(<span class="dt">quantiles =</span> <span class="fl">0.5</span>, <span class="dt">colour =</span> <span class="st">&#39;green&#39;</span>) </code></pre></div>
<pre><code>## Smoothing formula not specified. Using: y ~ x
## Smoothing formula not specified. Using: y ~ x</code></pre>
<p><img src="Material_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We can interpret the causal relationship in quantile regression only under rank invariant condition. This requires that individuals have always the same ranking in the distribution of <span class="math inline">\(Y(X)\)</span> no matter the <span class="math inline">\(X\)</span>. This is difficult to verify or believe in actual applications, but feasible in theory.</p>
<p>Under the rank invariant condition <span class="math inline">\(\beta_{\tau}\)</span> can be interpreted as the effect on <span class="math inline">\(Y\)</span> of an increase of one unit of <span class="math inline">\(X\)</span> among entities at rank <span class="math inline">\(\tau\)</span> in the distribution <span class="math inline">\(Y|X=x\)</span>.</p>
</div>
</div>
<div id="replication-of-a-paper-using-quantile-regression" class="section level2">
<h2><span class="header-section-number">2.3</span> Replication of a paper using quantile regression</h2>
<p>We are going to replicate the quantile regression procedure by <span class="citation">(Abrevaya 2002)</span>. In the <a href="https://link.springer.com/article/10.1007/s001810000052">paper</a> the author investigates the impact of different demographic characteristics and maternal behaviour on the weight at birth in the United States in 1992 and 1996. Why is this relevant:</p>
<ul>
<li>There is a correlation between health problems after birth for underweight chidren</li>
<li>There might be a relation with labor market participation and educational attaintment later in life</li>
<li>There are incentives to create specific programs to deal with underweight children; it is important to understand such behaviours</li>
</ul>
<div id="data" class="section level4">
<h4><span class="header-section-number">2.3.0.1</span> Data:</h4>
<p>In order to get the data we access the following <a href="https://www.nber.org/data/vital-statistics-natality-data.html">link</a>. Here you can download the ‘NCHS’ Vital Statistics Natality Birth Data’, which is the data used in the paper. We are using only the 1992 and 1996 waves. To download the data follow this link <a href="https://www.nber.org/natality/1992/natl1992.csv.zip">for the zip CSV file of 1992</a>. One important thing to do when analizing the data is understand your data before the actual analysis. Before you start you take a minute or two to consider:</p>
<ul>
<li>What is the data?</li>
<li>Where does it come from? What is the universe, the population and what is your sample.</li>
<li>What is the shape, format of your data? Do I have access to a data dictionary?</li>
</ul>
<p>In this case many of this questions are available in the documentation that is provided [at the following link] (<a href="https://www.nber.org/natality/1992/natl1992.pdf" class="uri">https://www.nber.org/natality/1992/natl1992.pdf</a>) detailing every variable in the dataset. From the documentation we can see the kind of information (a glimpse of the amount of variables) and the data counts (<span class="math inline">\(4&#39;069&#39;428\)</span> observations). An indicator of the size of the data is the size of the file: the zip file is <em>156 Mb</em> and the uncompressed version of the CSV <em>2.07 GB</em>! Even if this does not seem much, consider that all this data is stored in the cache of your RAM memory, and it can easily slow down even recent machines. For this reason it is better to read in only the columns that we are interested in. This requires reading the manual and a prior inspection of a subset of the data, which allows you to know the structure, column types and other properties. The most efficient function to open plain text files is <em>‘fread’</em> from the <em>‘data.table’</em> package <span class="citation">(Dowle and Srinivasan 2019)</span>. First let’s investigate the data. The first thing to do is to load the required libraries int the current session:</p>
<ul>
<li><em>‘data.table’</em> to open the data</li>
<li><em>‘quantreg’</em> to perform the quantile regression estimation</li>
<li><em>‘stargazer’</em> to export the results in latex</li>
<li><em>‘dplyr’</em> to manipulate the data to create the summary statistics</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)
<span class="kw">library</span>(quantreg)
<span class="kw">library</span>(stargazer)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(kableExtra)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_source &lt;-<span class="st"> &quot;YOUR PATH GOES HERE&quot;</span>
<span class="co"># for macOS and linux: use / in your path to data</span>
<span class="co"># for Win: rembember to use \\ instead of /</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">fread</span>(path_source, <span class="dt">nrows =</span> <span class="kw">c</span>(<span class="dv">100</span>))
<span class="kw">head</span>(data[,<span class="kw">c</span>(<span class="dv">35</span><span class="op">:</span><span class="dv">41</span>)])</code></pre></div>
<pre><code>##    mage12 mage8 ormoth orracem mraceimp mrace mrace3
## 1:      9     4      0       7       NA     2      3
## 2:      9     4      0       7       NA     2      3
## 3:      8     3      0       7       NA     2      3
## 4:      8     3      0       6       NA     1      1
## 5:      5     2      0       6       NA     1      1
## 6:      9     4      0       6       NA     1      1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">type_of_data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(typeof)
type_of_data[<span class="dv">35</span><span class="op">:</span><span class="dv">41</span>]</code></pre></div>
<pre><code>##    mage12   mage8  ormoth orracem mraceimp   mrace  mrace3
## 1 integer integer integer integer  logical integer integer</code></pre>
<p>Now that we have had a look at the content of the database, let’s import the data and clean it. To import only the relevant variables of the paper we create a list containing all the relevant variables for the estimation. I used the codebook to construct this list. Then we use this list within ‘fread()’ to import solely the desired columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">desired &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;birmon&quot;</span>,<span class="st">&quot;mrace3&quot;</span>,<span class="st">&quot;dmage&quot;</span>,<span class="st">&quot;dbirwt&quot;</span>,<span class="st">&quot;dplural&quot;</span>,<span class="st">&quot;stnatexp&quot;</span>,
             <span class="st">&quot;mraceimp&quot;</span>,<span class="st">&quot;dmarimp&quot;</span>,<span class="st">&quot;mageimp&quot;</span>,<span class="st">&quot;cseximp&quot;</span>,<span class="st">&quot;dmar&quot;</span>,<span class="st">&quot;meduc6&quot;</span>, 
             <span class="st">&quot;wtgain&quot;</span>, <span class="st">&quot;mpre5&quot;</span>, <span class="st">&quot;tobacco&quot;</span>,<span class="st">&quot;cigar&quot;</span>, <span class="st">&quot;csex&quot;</span>, <span class="st">&quot;plurimp&quot;</span>, <span class="st">&quot;restatus&quot;</span>)

data &lt;-<span class="st"> </span><span class="kw">fread</span>(path_source, <span class="dt">select =</span> desired)</code></pre></div>
<p>Following the indications of the paper:</p>
<blockquote>
<p>To cut down he sample size, we have decided to use only births occurring in June […] There is no evidence that suggest that the June samplediffers in any meaningful way to the full sample. The sample was further limited to singleton births and mothers who were either white or black, between ages 18 and 45, and residents of the United States. Observations for which there was missing information on any relevant variable were also dropped. Unfortunately, all births occurring in California, Indiana, New York, and South Dakota had to be dropped from the sample since these states either did not asked a question about smoking during pregnancy or did not ask it in a form compatible with NHCS standards…</p>
</blockquote>
<p>We need to apply the following filters:</p>
<ul>
<li>Remove all obs. in months different than the sixth (June)</li>
<li>Remove all non white or non black mothers</li>
<li>Remove all obs. which age is not in [18,45] group</li>
<li>Remove the non stated weights</li>
<li>Remove all the obs. from California, New York, Indiana and South Dakota</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>restatus<span class="op">!=</span><span class="dv">4</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>birmon<span class="op">==</span><span class="dv">6</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>mrace3<span class="op">!=</span><span class="dv">2</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>dmage<span class="op">&gt;</span><span class="dv">17</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>dmage<span class="op">&lt;</span><span class="dv">46</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>dbirwt<span class="op">!=</span><span class="dv">9999</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>dplural<span class="op">==</span><span class="dv">1</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(<span class="op">!</span>(data<span class="op">$</span>stnatexp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;05&quot;</span>,<span class="st">&quot;33&quot;</span>,<span class="st">&quot;34&quot;</span>,<span class="st">&quot;15&quot;</span>,<span class="st">&quot;43&quot;</span>))),]</code></pre></div>
<p>Moreover, we remove the missing observations. One particularity of many of the variables of the database is that the missing values are coded, meaning that are not representes by <code>'NA'</code> but by a code that changes in each variable. We are going to remove also the missing from those variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(<span class="op">!</span>(data<span class="op">$</span>plurimp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>))),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(<span class="op">!</span>(data<span class="op">$</span>mraceimp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>))),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(<span class="op">!</span>(data<span class="op">$</span>dmarimp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>))),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(<span class="op">!</span>(data<span class="op">$</span>mageimp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>))),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(<span class="op">!</span>(data<span class="op">$</span>cseximp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>))),]
toKeep &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dbirwt&quot;</span>, <span class="st">&quot;mrace3&quot;</span>,<span class="st">&quot;dmar&quot;</span>,<span class="st">&quot;dmage&quot;</span>,<span class="st">&quot;meduc6&quot;</span>, <span class="st">&quot;wtgain&quot;</span>, <span class="st">&quot;mpre5&quot;</span>, <span class="st">&quot;tobacco&quot;</span>,<span class="st">&quot;cigar&quot;</span>, <span class="st">&quot;csex&quot;</span>)
data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(data)
data &lt;-<span class="st"> </span>data[,toKeep]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>dbirwt<span class="op">!=</span><span class="dv">9999</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>wtgain<span class="op">!=</span><span class="dv">99</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>dmage<span class="op">!=</span><span class="dv">99</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>meduc6<span class="op">!=</span><span class="dv">6</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>mpre5<span class="op">!=</span><span class="dv">5</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>tobacco<span class="op">!=</span><span class="dv">9</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>cigar<span class="op">!=</span><span class="dv">99</span>),]
data &lt;-<span class="st"> </span>data[<span class="kw">which</span>(data<span class="op">$</span>wtgain <span class="op">!=</span><span class="dv">99</span>),]</code></pre></div>
<p>For the categorical variables (i.e. education of the mother), we create dummy variables. We keep the contrast (levels of reference) according to the paper. In this way we will be able to compare the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data<span class="op">$</span>black &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>mrace3<span class="op">==</span><span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>married &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>dmar<span class="op">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>agesq &lt;-<span class="st"> </span>(data<span class="op">$</span>dmage)<span class="op">^</span><span class="dv">2</span>
data<span class="op">$</span>hsgrad &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>meduc6<span class="op">==</span><span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>somecoll &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>meduc6<span class="op">==</span><span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>collgrad &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>meduc6<span class="op">==</span><span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>natal2 &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>mpre5<span class="op">==</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>natal3 &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>mpre5<span class="op">==</span><span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>novisit &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>mpre5<span class="op">==</span><span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>nosmoke &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>tobacco<span class="op">==</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>)
data<span class="op">$</span>boy &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data<span class="op">$</span>csex<span class="op">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</code></pre></div>
<p>We also relabel variables to match those in the paper:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">finalVars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dbirwt&quot;</span>,<span class="st">&quot;black&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;dmage&quot;</span>, <span class="st">&quot;agesq&quot;</span>, <span class="st">&quot;hsgrad&quot;</span>, <span class="st">&quot;somecoll&quot;</span>, <span class="st">&quot;collgrad&quot;</span>, <span class="st">&quot;wtgain&quot;</span>, <span class="st">&quot;natal2&quot;</span>, <span class="st">&quot;natal3&quot;</span>, <span class="st">&quot;novisit&quot;</span>, <span class="st">&quot;nosmoke&quot;</span>, <span class="st">&quot;cigar&quot;</span>, <span class="st">&quot;boy&quot;</span>)
data &lt;-<span class="st"> </span>data[, finalVars]
<span class="kw">names</span>(data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;birwt&quot;</span>,<span class="st">&quot;black&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;agesq&quot;</span>, <span class="st">&quot;hsgrad&quot;</span>, <span class="st">&quot;somecoll&quot;</span>, <span class="st">&quot;collgrad&quot;</span>,<span class="st">&quot;wtgain&quot;</span>, <span class="st">&quot;natal2&quot;</span>, <span class="st">&quot;natal3&quot;</span>, <span class="st">&quot;novisit&quot;</span>, <span class="st">&quot;nosmoke&quot;</span>, <span class="st">&quot;cigar&quot;</span>, <span class="st">&quot;boy&quot;</span>) </code></pre></div>
<p>Now let’s make a summary table. We are going to use the <code>dplyr</code> package <span class="citation">(Wickham et al. 2018)</span> for the data transformation and the <code>stargazer</code> package <span class="citation">(Hlavac 2018)</span> to nicely export the results. We construct the columns for all selected variables. To store the results it is convenient to save tables in ( ) format, so you can use them directly form that folder into your paper, or copy the result from them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">desc_stats &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(<span class="kw">t</span>(data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(mean)),<span class="kw">t</span>(data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(sd)))),<span class="dv">3</span>)
<span class="kw">names</span>(desc_stats) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mean&quot;</span>, <span class="st">&quot;Standard Deviation&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stargazer<span class="op">::</span><span class="kw">stargazer</span>(desc_stats,
<span class="dt">type=</span><span class="kw">ifelse</span>(knitr<span class="op">::</span><span class="kw">is_latex_output</span>(),<span class="st">&quot;latex&quot;</span>,<span class="st">&quot;html&quot;</span>),
<span class="dt">label=</span>knitr<span class="op">::</span>opts_current<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;label&quot;</span>),
<span class="dt">title=</span><span class="st">&quot;Summary Statistics 1992&quot;</span>, <span class="dt">summary =</span> <span class="ot">FALSE</span>, <span class="dt">out=</span><span class="st">&quot;./images/summary_table.tex&quot;</span>)</code></pre></div>
<table style="text-align:center">
<caption>
<span id="tab:unnamed-chunk-14">Table 2.1: </span><strong>Summary Statistics 1992</strong>
</caption>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
Mean
</td>
<td>
Standard Deviation
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
birwt
</td>
<td>
3,388.683
</td>
<td>
571.511
</td>
</tr>
<tr>
<td style="text-align:left">
black
</td>
<td>
0.163
</td>
<td>
0.370
</td>
</tr>
<tr>
<td style="text-align:left">
married
</td>
<td>
0.752
</td>
<td>
0.432
</td>
</tr>
<tr>
<td style="text-align:left">
age
</td>
<td>
26.960
</td>
<td>
5.434
</td>
</tr>
<tr>
<td style="text-align:left">
agesq
</td>
<td>
756.389
</td>
<td>
303.877
</td>
</tr>
<tr>
<td style="text-align:left">
hsgrad
</td>
<td>
0.394
</td>
<td>
0.489
</td>
</tr>
<tr>
<td style="text-align:left">
somecoll
</td>
<td>
0.232
</td>
<td>
0.422
</td>
</tr>
<tr>
<td style="text-align:left">
collgrad
</td>
<td>
0.211
</td>
<td>
0.408
</td>
</tr>
<tr>
<td style="text-align:left">
wtgain
</td>
<td>
30.760
</td>
<td>
12.245
</td>
</tr>
<tr>
<td style="text-align:left">
natal2
</td>
<td>
0.158
</td>
<td>
0.365
</td>
</tr>
<tr>
<td style="text-align:left">
natal3
</td>
<td>
0.026
</td>
<td>
0.161
</td>
</tr>
<tr>
<td style="text-align:left">
novisit
</td>
<td>
0.009
</td>
<td>
0.096
</td>
</tr>
<tr>
<td style="text-align:left">
nosmoke
</td>
<td>
0.830
</td>
<td>
0.376
</td>
</tr>
<tr>
<td style="text-align:left">
cigar
</td>
<td>
2.139
</td>
<td>
5.737
</td>
</tr>
<tr>
<td style="text-align:left">
boy
</td>
<td>
0.513
</td>
<td>
0.500
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
</table>
<p>Now let’s calculate the quantile regression:</p>
<p>How does the command rq() work? An easy way to access the help file of a command, just put a question mark before it in the console, i.e. if you want to collect information on the <em>mean()</em> function you would type <code>?mean</code>. For our quantile regression, we are going to use the function <code>rq()</code> from the ‘quantreg’ package.</p>
<p>From the help file we can see that the principal inputs of the function are ‘formula’ (the relationship to evaluate), the ‘tau’ (the vector of quantiles), and the ‘data’, which is a dataframe containing the information. Regarding the data it requires a specific type of object, a <em>‘data.frame’</em>, and also specifies that if we have factors among our variables, it is important to provide a vector with the contrast levels. We do not have to provide it since we already constructed our dummies for such purpose. We are only missing the formula and the quantile vector.</p>
<p>For the moment we are going to construct the formula:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Y &lt;-<span class="st"> &quot;birwt&quot;</span>
X &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">names</span>(data[,<span class="op">-</span><span class="dv">1</span>]),<span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>)
formula_qr &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste</span>(Y, <span class="st">&quot; ~ &quot;</span>, X))
formula_qr</code></pre></div>
<pre><code>## birwt ~ black + married + age + agesq + hsgrad + somecoll + collgrad + 
##     wtgain + natal2 + natal3 + novisit + nosmoke + cigar + boy</code></pre>
<p>And then we construct the vector of quantiles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">quantiles_table &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>)</code></pre></div>
<p>As in the main slides, if the number of observations is not large enough, we can use the simplex method, but given that we have more than a hundred thousand observations we are going to use the <em>‘Frish-Newton’ interior point</em> method. We specify this option in the command options including the <code>method = &quot;fn&quot;</code> statement. After the calculation we will have an object of class ‘rq’ or ‘rqs’, depending on the number of quantiles specified; this might be relevant since some commands might behave differently if operated over this object. For example, the command <code>summary</code>, that is often used to get the summary statistics of a ‘data.frame’, when applied to a ‘rq’ or ‘rqs’ object returns the summary of the fit of the QR.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">quant_reg_res1992 &lt;-<span class="st"> </span><span class="kw">rq</span>(formula_qr,<span class="dt">tau =</span> quantiles_table, <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&#39;fn&#39;</span>)
qr_results &lt;-<span class="st"> </span><span class="kw">summary.rqs</span>(quant_reg_res1992)
qr_results</code></pre></div>
<pre><code>## 
## Call: rq(formula = formula_qr, tau = quantiles_table, data = data, 
##     method = &quot;fn&quot;)
## 
## tau: [1] 0.1
## 
## Coefficients:
##             Value      Std. Error t value    Pr(&gt;|t|)  
## (Intercept) 1556.90509   58.45879   26.63252    0.00000
## black       -253.65558    7.91665  -32.04078    0.00000
## married       73.32313    6.55406   11.18744    0.00000
## age           45.17747    4.27348   10.57159    0.00000
## agesq         -0.78109    0.07630  -10.23749    0.00000
## hsgrad        28.57972    7.31354    3.90778    0.00009
## somecoll      49.49438    8.22498    6.01757    0.00000
## collgrad      82.64542    8.79916    9.39242    0.00000
## wtgain        11.77551    0.16692   70.54735    0.00000
## natal2         6.17644    6.55496    0.94225    0.34606
## natal3        39.43374   15.11504    2.60891    0.00908
## novisit     -388.58389   44.08937   -8.81355    0.00000
## nosmoke      170.75013   11.15951   15.30087    0.00000
## cigar         -3.80301    0.63954   -5.94644    0.00000
## boy           87.76342    4.50293   19.49028    0.00000
## 
## Call: rq(formula = formula_qr, tau = quantiles_table, data = data, 
##     method = &quot;fn&quot;)
## 
## tau: [1] 0.25
## 
## Coefficients:
##             Value      Std. Error t value    Pr(&gt;|t|)  
## (Intercept) 2020.48850   37.98519   53.19147    0.00000
## black       -216.79384    4.64082  -46.71456    0.00000
## married       55.18092    4.23478   13.03042    0.00000
## age           36.72168    2.75656   13.32156    0.00000
## agesq         -0.59142    0.04893  -12.08786    0.00000
## hsgrad        25.07794    4.76923    5.25828    0.00000
## somecoll      40.54889    5.23706    7.74268    0.00000
## collgrad      57.60057    5.76602    9.98967    0.00000
## wtgain         9.90517    0.11880   83.37620    0.00000
## natal2         2.83300    4.17057    0.67928    0.49696
## natal3        12.67925    9.60040    1.32070    0.18660
## novisit     -196.45154   24.28562   -8.08921    0.00000
## nosmoke      171.83979    7.21094   23.83042    0.00000
## cigar         -3.51950    0.46625   -7.54859    0.00000
## boy          109.56824    2.93365   37.34874    0.00000
## 
## Call: rq(formula = formula_qr, tau = quantiles_table, data = data, 
##     method = &quot;fn&quot;)
## 
## tau: [1] 0.5
## 
## Coefficients:
##             Value      Std. Error t value    Pr(&gt;|t|)  
## (Intercept) 2377.88346   31.58611   75.28256    0.00000
## black       -199.07093    3.82874  -51.99386    0.00000
## married       50.56335    3.57758   14.13338    0.00000
## age           34.63588    2.29095   15.11860    0.00000
## agesq         -0.52963    0.04064  -13.03315    0.00000
## hsgrad        17.54254    3.82369    4.58786    0.00000
## somecoll      31.69835    4.44505    7.13116    0.00000
## collgrad      36.83945    4.81609    7.64925    0.00000
## wtgain         9.13414    0.10254   89.08206    0.00000
## natal2        -4.47675    3.67308   -1.21880    0.22292
## natal3         3.96735    7.23390    0.54844    0.58339
## novisit     -147.23008   15.30005   -9.62285    0.00000
## nosmoke      158.82091    6.10852   25.99989    0.00000
## cigar         -3.90210    0.39009  -10.00299    0.00000
## boy          129.12756    2.55257   50.58719    0.00000
## 
## Call: rq(formula = formula_qr, tau = quantiles_table, data = data, 
##     method = &quot;fn&quot;)
## 
## tau: [1] 0.75
## 
## Coefficients:
##             Value      Std. Error t value    Pr(&gt;|t|)  
## (Intercept) 2715.22798   34.34314   79.06174    0.00000
## black       -192.40481    4.26347  -45.12869    0.00000
## married       42.45607    4.08114   10.40300    0.00000
## age           31.90923    2.50037   12.76181    0.00000
## agesq         -0.43958    0.04427   -9.92928    0.00000
## hsgrad        15.02372    4.38866    3.42330    0.00062
## somecoll      26.97497    4.98902    5.40687    0.00000
## collgrad      16.26961    5.42208    3.00062    0.00269
## wtgain         8.83829    0.11772   75.08147    0.00000
## natal2        -0.54374    4.07482   -0.13344    0.89385
## natal3        -6.23893    8.86964   -0.70340    0.48181
## novisit     -126.64150   16.13168   -7.85049    0.00000
## nosmoke      153.22724    6.65373   23.02876    0.00000
## cigar         -4.46120    0.40831  -10.92596    0.00000
## boy          142.40192    2.86197   49.75669    0.00000
## 
## Call: rq(formula = formula_qr, tau = quantiles_table, data = data, 
##     method = &quot;fn&quot;)
## 
## tau: [1] 0.9
## 
## Coefficients:
##             Value      Std. Error t value    Pr(&gt;|t|)  
## (Intercept) 2967.68273   47.25148   62.80613    0.00000
## black       -182.08652    5.68366  -32.03682    0.00000
## married       38.55994    5.42803    7.10386    0.00000
## age           33.78764    3.45080    9.79126    0.00000
## agesq         -0.43555    0.06158   -7.07260    0.00000
## hsgrad        13.35546    5.86831    2.27586    0.02286
## somecoll      18.63983    6.67219    2.79366    0.00521
## collgrad      -4.66343    7.47727   -0.62368    0.53284
## wtgain         8.57592    0.15653   54.78798    0.00000
## natal2         3.79637    5.63320    0.67393    0.50036
## natal3       -25.49765   10.73838   -2.37444    0.01758
## novisit     -101.65891   17.28236   -5.88223    0.00000
## nosmoke      150.21941    9.44534   15.90408    0.00000
## cigar         -5.16788    0.60668   -8.51835    0.00000
## boy          153.58224    3.83777   40.01857    0.00000</code></pre>
<p>One important consideration is the kind of errors that the procedure is calculating when running the summary.</p>
<p>Nevertheless this kind of results are not easy to handle and manage, and is desireable to have a summary table like the one of the paper or to summarize the results in just one table. We have seen already that is possible to save the results in LaTeX, now we are going to save them in TXT format, which might be usefull in many cases. To this end, we select the first and second column of the results. If in this case the list contains only five items, is still acceptable to do it line by line. If an operation has more elements and is used often it is better to write a function to save time and avoid copypaste mistakes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab_res &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(qr_results[[<span class="dv">1</span>]]<span class="op">$</span>coefficients[,<span class="dv">1</span>], 
                 qr_results[[<span class="dv">2</span>]]<span class="op">$</span>coefficients[,<span class="dv">1</span>], 
                 qr_results[[<span class="dv">3</span>]]<span class="op">$</span>coefficients[,<span class="dv">1</span>], 
                 qr_results[[<span class="dv">4</span>]]<span class="op">$</span>coefficients[,<span class="dv">1</span>], 
                 qr_results[[<span class="dv">5</span>]]<span class="op">$</span>coefficients[,<span class="dv">1</span>]))
<span class="kw">names</span>(tab_res) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Tau_&quot;</span>,quantiles_table,<span class="st">&quot;_beta&quot;</span>)

tab_ES &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(qr_results[[<span class="dv">1</span>]]<span class="op">$</span>coefficients[,<span class="dv">2</span>], 
                 qr_results[[<span class="dv">2</span>]]<span class="op">$</span>coefficients[,<span class="dv">2</span>], 
                 qr_results[[<span class="dv">3</span>]]<span class="op">$</span>coefficients[,<span class="dv">2</span>], 
                 qr_results[[<span class="dv">4</span>]]<span class="op">$</span>coefficients[,<span class="dv">2</span>], 
                 qr_results[[<span class="dv">5</span>]]<span class="op">$</span>coefficients[,<span class="dv">2</span>]))

<span class="kw">names</span>(tab_ES) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Tau_&quot;</span>,quantiles_table,<span class="st">&quot;_SE&quot;</span>)

results &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(tab_res,tab_ES))
results &lt;-<span class="st"> </span>results[,<span class="kw">sort</span>(<span class="kw">names</span>(results))]
results &lt;-<span class="st"> </span>results[<span class="op">-</span><span class="dv">1</span>,]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stargazer<span class="op">::</span><span class="kw">stargazer</span>(results, <span class="dt">type=</span><span class="st">&#39;text&#39;</span>, <span class="dt">out=</span><span class="st">&quot;./images/qr_res1992.tex&quot;</span>, <span class="dt">summary =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## 
## ====================================================================================================================================
##          Tau_0.1_beta Tau_0.1_SE Tau_0.25_beta Tau_0.25_SE Tau_0.5_beta Tau_0.5_SE Tau_0.75_beta Tau_0.75_SE Tau_0.9_beta Tau_0.9_SE
## ------------------------------------------------------------------------------------------------------------------------------------
## black      -253.656     7.917      -216.794       4.641      -199.071     3.829      -192.405       4.263      -182.087     5.684   
## married     73.323      6.554       55.181        4.235       50.563      3.578       42.456        4.081       38.560      5.428   
## age         45.177      4.273       36.722        2.757       34.636      2.291       31.909        2.500       33.788      3.451   
## agesq       -0.781      0.076       -0.591        0.049       -0.530      0.041       -0.440        0.044       -0.436      0.062   
## hsgrad      28.580      7.314       25.078        4.769       17.543      3.824       15.024        4.389       13.355      5.868   
## somecoll    49.494      8.225       40.549        5.237       31.698      4.445       26.975        4.989       18.640      6.672   
## collgrad    82.645      8.799       57.601        5.766       36.839      4.816       16.270        5.422       -4.663      7.477   
## wtgain      11.776      0.167        9.905        0.119       9.134       0.103        8.838        0.118       8.576       0.157   
## natal2      6.176       6.555        2.833        4.171       -4.477      3.673       -0.544        4.075       3.796       5.633   
## natal3      39.434      15.115      12.679        9.600       3.967       7.234       -6.239        8.870      -25.498      10.738  
## novisit    -388.584     44.089     -196.452      24.286      -147.230     15.300     -126.642      16.132      -101.659     17.282  
## nosmoke    170.750      11.160      171.840       7.211      158.821      6.109       153.227       6.654      150.219      9.445   
## cigar       -3.803      0.640       -3.519        0.466       -3.902      0.390       -4.461        0.408       -5.168      0.607   
## boy         87.763      4.503       109.568       2.934      129.128      2.553       142.402       2.862      153.582      3.838   
## ------------------------------------------------------------------------------------------------------------------------------------</code></pre>
<p>As aforementioned in the case of a vector of 20 or 50 quantiles it is better to use a <strong>user written function</strong>. We will use this opportunity to remember how to define user written functions (even if in this example is not necessary). An example of a function is presented to highlight the important parts:</p>
<ul>
<li>Define the name</li>
<li>Define in parenteses the inputs and parameters of the function - remember that default values and ordering are important</li>
<li>Define in brackets the procedure of the function</li>
<li>Return the output, results of the operation</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table_rq_beta_sd &lt;-<span class="st"> </span><span class="cf">function</span>(qr_obj){
        <span class="co"># The function creates a summary table from the results of the command rq()</span>
        
        len &lt;-<span class="st"> </span><span class="kw">length</span>(qr_obj)
        
        res_beta &lt;-<span class="st"> </span><span class="kw">c</span>()
        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>len) {
                res &lt;-<span class="st"> </span>qr_results[[i]]<span class="op">$</span>coefficients[,<span class="dv">1</span>] 
                res_beta &lt;-<span class="st"> </span><span class="kw">cbind</span>(res_beta,res)
        }
        
        res_se &lt;-<span class="st"> </span><span class="kw">c</span>()
        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>len) {
                resse &lt;-<span class="st"> </span>qr_results[[i]]<span class="op">$</span>coefficients[,<span class="dv">2</span>] 
                res_se &lt;-<span class="st"> </span><span class="kw">cbind</span>(res_se,resse)
        }
        
        tau &lt;-<span class="st"> </span><span class="kw">c</span>()
        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>len) {
                tau &lt;-<span class="st"> </span><span class="kw">c</span>(tau,qr_results[[i]]<span class="op">$</span>tau)
        }
        
        res_beta &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(res_beta)
        <span class="kw">names</span>(res_beta) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Quant_&quot;</span>,tau,<span class="st">&quot;_beta&quot;</span>)
        res_se &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(res_se)
        <span class="kw">names</span>(res_se) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Quant_&quot;</span>,tau,<span class="st">&quot;_se&quot;</span>)
        
        
        results &lt;-<span class="st"> </span><span class="kw">cbind.data.frame</span>(res_beta,res_se)
        results &lt;-<span class="st"> </span>results[, <span class="kw">order</span>(<span class="kw">names</span>(results))]
        <span class="kw">return</span>(results)
}</code></pre></div>
<p>Now we just have to call the function and introduce the object we created before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table_rq_beta_sd</span>(qr_results)</code></pre></div>
<pre><code>##             Quant_0.1_beta Quant_0.1_se Quant_0.25_beta Quant_0.25_se
## (Intercept)   1556.9050909  58.45879291    2020.4884992   37.98519460
## black         -253.6555790   7.91664698    -216.7938389    4.64081903
## married         73.3231343   6.55406020      55.1809157    4.23477730
## age             45.1774681   4.27347783      36.7216751    2.75655948
## agesq           -0.7810851   0.07629657      -0.5914186    0.04892666
## hsgrad          28.5797213   7.31354472      25.0779441    4.76923272
## somecoll        49.4943765   8.22498108      40.5488870    5.23705765
## collgrad        82.6454195   8.79916500      57.6005742    5.76601552
## wtgain          11.7755114   0.16691643       9.9051687    0.11880091
## natal2           6.1764400   6.55495922       2.8329988    4.17057029
## natal3          39.4337385  15.11503777      12.6792476    9.60040130
## novisit       -388.5838921  44.08936522    -196.4515370   24.28562273
## nosmoke        170.7501323  11.15950768     171.8397939    7.21094247
## cigar           -3.8030072   0.63954401      -3.5194985    0.46624584
## boy             87.7634154   4.50293347     109.5682422    2.93365299
##             Quant_0.5_beta Quant_0.5_se Quant_0.75_beta Quant_0.75_se
## (Intercept)   2377.8834596  31.58611134    2715.2279805   34.34313590
## black         -199.0709271   3.82873901    -192.4048070    4.26346977
## married         50.5633497   3.57758349      42.4560697    4.08113674
## age             34.6358786   2.29094506      31.9092314    2.50036832
## agesq           -0.5296273   0.04063692      -0.4395786    0.04427096
## hsgrad          17.5425396   3.82368815      15.0237215    4.38866496
## somecoll        31.6983508   4.44505051      26.9749700    4.98902204
## collgrad        36.8394529   4.81608945      16.2696096    5.42208252
## wtgain           9.1341375   0.10253622       8.8382909    0.11771601
## natal2          -4.4767476   3.67307972      -0.5437404    4.07482199
## natal3           3.9673501   7.23390304      -6.2389299    8.86964396
## novisit       -147.2300835  15.30004647    -126.6415003   16.13167721
## nosmoke        158.8209086   6.10852283     153.2272351    6.65373468
## cigar           -3.9020968   0.39009317      -4.4612046    0.40831223
## boy            129.1275630   2.55257411     142.4019151    2.86196534
##             Quant_0.9_beta Quant_0.9_se
## (Intercept)   2967.6827348  47.25148330
## black         -182.0865220   5.68366323
## married         38.5599376   5.42802626
## age             33.7876428   3.45079678
## agesq           -0.4355504   0.06158277
## hsgrad          13.3554587   5.86831170
## somecoll        18.6398317   6.67219287
## collgrad        -4.6634288   7.47727096
## wtgain           8.5759164   0.15652917
## natal2           3.7963741   5.63320458
## natal3         -25.4976502  10.73837729
## novisit       -101.6589089  17.28236339
## nosmoke        150.2194090   9.44533549
## cigar           -5.1678773   0.60667596
## boy            153.5822439   3.83777441</code></pre>
<p>If instead we want to reproduce the table of the paper, we need to compute each of the QR in a separate object and calculate the OLS. Given that the QR regression results table has a different variable order than before, we use for comparison. We also redefine the formula to preserve such order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">order_qr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;birwt&quot;</span>,<span class="st">&quot;black&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;boy&quot;</span>, <span class="st">&quot;nosmoke&quot;</span>, <span class="st">&quot;cigar&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;agesq&quot;</span>, <span class="st">&quot;hsgrad&quot;</span>, <span class="st">&quot;somecoll&quot;</span>, <span class="st">&quot;collgrad&quot;</span>,<span class="st">&quot;wtgain&quot;</span>, <span class="st">&quot;natal2&quot;</span>, <span class="st">&quot;natal3&quot;</span>, <span class="st">&quot;novisit&quot;</span>)

data &lt;-<span class="st"> </span>data[,order_qr]
Y &lt;-<span class="st"> &quot;birwt&quot;</span>
X &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">names</span>(data[,<span class="op">-</span><span class="dv">1</span>]),<span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>)
formula_qr &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste</span>(Y, <span class="st">&quot; ~ &quot;</span>, X))
formula_qr</code></pre></div>
<pre><code>## birwt ~ black + married + boy + nosmoke + cigar + age + agesq + 
##     hsgrad + somecoll + collgrad + wtgain + natal2 + natal3 + 
##     novisit</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p10 &lt;-<span class="st"> </span><span class="kw">rq</span>(formula_qr,<span class="dt">tau =</span> <span class="kw">c</span>(<span class="fl">0.1</span>), <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&#39;fn&#39;</span>)
p25 &lt;-<span class="st"> </span><span class="kw">rq</span>(formula_qr,<span class="dt">tau =</span> <span class="kw">c</span>(<span class="fl">0.25</span>), <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&#39;fn&#39;</span>)
p50 &lt;-<span class="st"> </span><span class="kw">rq</span>(formula_qr,<span class="dt">tau =</span> <span class="kw">c</span>(<span class="fl">0.5</span>), <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&#39;fn&#39;</span>)
p75 &lt;-<span class="st"> </span><span class="kw">rq</span>(formula_qr,<span class="dt">tau =</span> <span class="kw">c</span>(<span class="fl">0.75</span>), <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&#39;fn&#39;</span>)
p90 &lt;-<span class="st"> </span><span class="kw">rq</span>(formula_qr,<span class="dt">tau =</span> <span class="kw">c</span>(<span class="fl">0.9</span>), <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&#39;fn&#39;</span>)
ols &lt;-<span class="st"> </span><span class="kw">lm</span>(formula_qr, <span class="dt">data =</span> data)</code></pre></div>
<p>Finally, we put the results in a paper format using LaTeX syntax and ‘stargazer’ functionality. The table presented shows the results for the QR estimation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stargazer</span>(p10,p25,p50,p75,p90,ols, <span class="dt">title =</span> <span class="st">&quot;Quantile Regression Results&quot;</span>, 
          <span class="dt">type=</span><span class="kw">ifelse</span>(knitr<span class="op">::</span><span class="kw">is_latex_output</span>(),<span class="st">&quot;latex&quot;</span>,<span class="st">&quot;html&quot;</span>), <span class="dt">out =</span><span class="st">&quot;./images/qr_rep_tab_92.tex&quot;</span>)</code></pre></div>
<table style="text-align:center">
<caption>
(#tab:)<strong>Quantile Regression Results</strong>
</caption>
<tr>
<td colspan="7" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="6">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="6" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="6">
birwt
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="5">
<em>quantile</em>
</td>
<td>
<em>OLS</em>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="5">
<em>regression</em>
</td>
<td>
<em></em>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
<td>
(4)
</td>
<td>
(5)
</td>
<td>
(6)
</td>
</tr>
<tr>
<td colspan="7" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
black
</td>
<td>
-253.656<sup>***</sup>
</td>
<td>
-216.794<sup>***</sup>
</td>
<td>
-199.071<sup>***</sup>
</td>
<td>
-192.405<sup>***</sup>
</td>
<td>
-182.087<sup>***</sup>
</td>
<td>
-220.271<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(7.917)
</td>
<td>
(4.641)
</td>
<td>
(3.829)
</td>
<td>
(4.263)
</td>
<td>
(5.684)
</td>
<td>
(3.574)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
married
</td>
<td>
73.323<sup>***</sup>
</td>
<td>
55.181<sup>***</sup>
</td>
<td>
50.563<sup>***</sup>
</td>
<td>
42.456<sup>***</sup>
</td>
<td>
38.560<sup>***</sup>
</td>
<td>
57.560<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(6.554)
</td>
<td>
(4.235)
</td>
<td>
(3.578)
</td>
<td>
(4.081)
</td>
<td>
(5.428)
</td>
<td>
(3.337)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
boy
</td>
<td>
87.763<sup>***</sup>
</td>
<td>
109.568<sup>***</sup>
</td>
<td>
129.128<sup>***</sup>
</td>
<td>
142.402<sup>***</sup>
</td>
<td>
153.582<sup>***</sup>
</td>
<td>
122.568<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(4.503)
</td>
<td>
(2.934)
</td>
<td>
(2.553)
</td>
<td>
(2.862)
</td>
<td>
(3.838)
</td>
<td>
(2.385)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
nosmoke
</td>
<td>
170.750<sup>***</sup>
</td>
<td>
171.840<sup>***</sup>
</td>
<td>
158.821<sup>***</sup>
</td>
<td>
153.227<sup>***</sup>
</td>
<td>
150.219<sup>***</sup>
</td>
<td>
161.929<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(11.160)
</td>
<td>
(7.211)
</td>
<td>
(6.109)
</td>
<td>
(6.654)
</td>
<td>
(9.445)
</td>
<td>
(5.643)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
cigar
</td>
<td>
-3.803<sup>***</sup>
</td>
<td>
-3.519<sup>***</sup>
</td>
<td>
-3.902<sup>***</sup>
</td>
<td>
-4.461<sup>***</sup>
</td>
<td>
-5.168<sup>***</sup>
</td>
<td>
-4.043<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.640)
</td>
<td>
(0.466)
</td>
<td>
(0.390)
</td>
<td>
(0.408)
</td>
<td>
(0.607)
</td>
<td>
(0.367)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
age
</td>
<td>
45.177<sup>***</sup>
</td>
<td>
36.722<sup>***</sup>
</td>
<td>
34.636<sup>***</sup>
</td>
<td>
31.909<sup>***</sup>
</td>
<td>
33.788<sup>***</sup>
</td>
<td>
37.584<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(4.273)
</td>
<td>
(2.757)
</td>
<td>
(2.291)
</td>
<td>
(2.500)
</td>
<td>
(3.451)
</td>
<td>
(2.071)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
agesq
</td>
<td>
-0.781<sup>***</sup>
</td>
<td>
-0.591<sup>***</sup>
</td>
<td>
-0.530<sup>***</sup>
</td>
<td>
-0.440<sup>***</sup>
</td>
<td>
-0.436<sup>***</sup>
</td>
<td>
-0.579<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.076)
</td>
<td>
(0.049)
</td>
<td>
(0.041)
</td>
<td>
(0.044)
</td>
<td>
(0.062)
</td>
<td>
(0.036)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
hsgrad
</td>
<td>
28.580<sup>***</sup>
</td>
<td>
25.078<sup>***</sup>
</td>
<td>
17.543<sup>***</sup>
</td>
<td>
15.024<sup>***</sup>
</td>
<td>
13.355<sup>**</sup>
</td>
<td>
16.684<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(7.314)
</td>
<td>
(4.769)
</td>
<td>
(3.824)
</td>
<td>
(4.389)
</td>
<td>
(5.868)
</td>
<td>
(3.653)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
somecoll
</td>
<td>
49.494<sup>***</sup>
</td>
<td>
40.549<sup>***</sup>
</td>
<td>
31.698<sup>***</sup>
</td>
<td>
26.975<sup>***</sup>
</td>
<td>
18.640<sup>***</sup>
</td>
<td>
30.372<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(8.225)
</td>
<td>
(5.237)
</td>
<td>
(4.445)
</td>
<td>
(4.989)
</td>
<td>
(6.672)
</td>
<td>
(4.180)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
collgrad
</td>
<td>
82.645<sup>***</sup>
</td>
<td>
57.601<sup>***</sup>
</td>
<td>
36.839<sup>***</sup>
</td>
<td>
16.270<sup>***</sup>
</td>
<td>
-4.663
</td>
<td>
36.718<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(8.799)
</td>
<td>
(5.766)
</td>
<td>
(4.816)
</td>
<td>
(5.422)
</td>
<td>
(7.477)
</td>
<td>
(4.580)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
wtgain
</td>
<td>
11.776<sup>***</sup>
</td>
<td>
9.905<sup>***</sup>
</td>
<td>
9.134<sup>***</sup>
</td>
<td>
8.838<sup>***</sup>
</td>
<td>
8.576<sup>***</sup>
</td>
<td>
10.490<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.167)
</td>
<td>
(0.119)
</td>
<td>
(0.103)
</td>
<td>
(0.118)
</td>
<td>
(0.157)
</td>
<td>
(0.098)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
natal2
</td>
<td>
6.176
</td>
<td>
2.833
</td>
<td>
-4.477
</td>
<td>
-0.544
</td>
<td>
3.796
</td>
<td>
7.731<sup>**</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(6.555)
</td>
<td>
(4.171)
</td>
<td>
(3.673)
</td>
<td>
(4.075)
</td>
<td>
(5.633)
</td>
<td>
(3.435)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
natal3
</td>
<td>
39.434<sup>***</sup>
</td>
<td>
12.679
</td>
<td>
3.967
</td>
<td>
-6.239
</td>
<td>
-25.498<sup>**</sup>
</td>
<td>
20.268<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(15.115)
</td>
<td>
(9.600)
</td>
<td>
(7.234)
</td>
<td>
(8.870)
</td>
<td>
(10.738)
</td>
<td>
(7.564)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
novisit
</td>
<td>
-388.584<sup>***</sup>
</td>
<td>
-196.452<sup>***</sup>
</td>
<td>
-147.230<sup>***</sup>
</td>
<td>
-126.642<sup>***</sup>
</td>
<td>
-101.659<sup>***</sup>
</td>
<td>
-193.737<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(44.089)
</td>
<td>
(24.286)
</td>
<td>
(15.300)
</td>
<td>
(16.132)
</td>
<td>
(17.282)
</td>
<td>
(12.534)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
1,556.905<sup>***</sup>
</td>
<td>
2,020.488<sup>***</sup>
</td>
<td>
2,377.883<sup>***</sup>
</td>
<td>
2,715.228<sup>***</sup>
</td>
<td>
2,967.683<sup>***</sup>
</td>
<td>
2,273.476<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(58.459)
</td>
<td>
(37.985)
</td>
<td>
(31.586)
</td>
<td>
(34.343)
</td>
<td>
(47.251)
</td>
<td>
(28.700)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="7" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
199,181
</td>
<td>
199,181
</td>
<td>
199,181
</td>
<td>
199,181
</td>
<td>
199,181
</td>
<td>
199,181
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
0.134
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
0.134
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
531.845 (df = 199166)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
2,202.321<sup>***</sup> (df = 14; 199166)
</td>
</tr>
<tr>
<td colspan="7" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="6" style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05; <sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
</div>
<div id="quantile-regression-visualization" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Quantile Regression visualization</h3>
<p>One of the most important ways to visualize and communicate the results from QR is plots. The ‘quantreg’ package has its own functionality. You will obtain graphs with or without confidence depending on the object you feed it: without CI if using the qr object before the summary, and with CI if it is fed the summary of a QR object. To plot we use the command <code>plot()</code>. In the first case we obtain all graphs for the previous estimation. A similar graph is presented in <span class="citation">(Koenker and Hallock 2001)</span>, in which the Authors the method and apply it to 1997 data (at this point you can reproduce the plots by yourself).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(quant_reg_res1992)</code></pre></div>
<p><img src="Material_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>If instead we want to inspect the effect we need more points, so more quantiles. We construct 19 observations and used the CI from the bootstrap option (as stated on the paper). In this case we only show the second independent variable (black dummy).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">time_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
reg_exp &lt;-<span class="st"> </span><span class="kw">rq</span>(formula_qr,<span class="dt">tau =</span> <span class="kw">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="dt">by =</span> <span class="fl">0.05</span>), <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&#39;fn&#39;</span>)
time_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()

<span class="kw">paste0</span>(<span class="st">&quot;Computing the quantiles took &quot;</span>,time_<span class="dv">1</span><span class="op">-</span>time_<span class="dv">0</span>)</code></pre></div>
<pre><code>## [1] &quot;Computing the quantiles took 30.0709180831909&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sum_reg &lt;-<span class="st"> </span><span class="kw">summary.rqs</span>(reg_exp, <span class="dt">method =</span> <span class="st">&#39;boot&#39;</span>)</code></pre></div>
<pre><code>## Warning in summary.rq(xi, U = U, ...): 98 non-positive fis</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">time_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()

<span class="kw">paste0</span>(<span class="st">&quot;Computing the errors took &quot;</span>,time_<span class="dv">2</span><span class="op">-</span>time_<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] &quot;Computing the errors took 1.09215033451716&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(sum_reg, <span class="dt">parm =</span> <span class="kw">c</span>(<span class="dv">2</span>))</code></pre></div>
<p><img src="Material_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>The plot shows the estimates values, the confidence intervals and the OLS estimated value, so we can compare if the QR offers additional insights.</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">2.4</span> Exercises</h2>
<div id="proposed-exercise-1" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Proposed exercise 1</h3>
<ul>
<li>Compute the quantile regression for the year 1996 to complete the descriptive statistics of the paper’s table. Are they similar to 1992 results? What is equal? What is different?</li>
<li>Compute the quantile regression for the same set of variables but for a recent year (after year 2000). Does the outcome change? If yes, what changes and how would you interpret it?</li>
</ul>
</div>
<div id="proposed-exercise-2" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Proposed exercise 2</h3>
<ul>
<li>Compute the quantile regression for the year 1992 and 1996 including a variable of your interest. Does the result change significantly? Why do you consider it relevant for the analysis? How do you interpret the results obtained?</li>
</ul>
</div>
</div>
<div id="more-on-quantiles" class="section level2">
<h2><span class="header-section-number">2.5</span> More on quantiles</h2>
<p>In this section I will only list other implementations of quantile regression that might be usefull for your future research. The list is presentend without any particular order. If you have any suggestions, please let me know:</p>
<ul>
<li>Decomposition methods using quantiles <span class="citation">(Machado and Mata 2005)</span></li>
<li>Un-conditional quantiles regression <span class="citation">(Firpo, Fortin, and Lemieux 2009)</span></li>
<li>Decomposition methods using un-conditional quantile methods <span class="citation">(Firpo, Fortin, and Lemieux 2018)</span></li>
<li>Quantile estimation with non linear effects</li>
<li>Parallel quantile estimation</li>
<li>Quantile regression for time series (CAViaR)</li>
<li>Quantile regression for Spatial Data (package McSpatial)</li>
<li>Quantile regression for panel data, which is under development since it does not exist (yet) a consistent estimator (package ‘rqpd’ and Ivan Canay’s package)</li>
</ul>
</div>
<div id="references" class="section level2">
<h2><span class="header-section-number">2.6</span> References</h2>
<p>This material was possible thanks to the slides of David MARGOLIS (in PSE resources), the <a href="https://freakonometrics.hypotheses.org/files/2017/05/erasmus-1.pdf">slides of Arthur CHARPENTIER</a>, and the <a href="http://www.crest.fr/ckfinder/userfiles/files/Pageperso/xdhaultfoeuille/course_qreg.pdf">slides of of the course of Xavier D’HAULTFOEUILLE</a> (ENSAE).</p>

<div id="refs" class="references">
<div>
<p>Abrevaya, Jason. 2002. “The Effects of Demographics and Maternal Behavior on the Distribution of Birth Outcomes.” In <em>Economic Applications of Quantile Regression</em>, 247–57. Springer.</p>
</div>
<div>
<p>Dowle, Matt, and Arun Srinivasan. 2019. <em>Data.table: Extension of ‘Data.frame‘</em>. <a href="https://CRAN.R-project.org/package=data.table" class="uri">https://CRAN.R-project.org/package=data.table</a>.</p>
</div>
<div>
<p>Firpo, Sergio, Nicole M Fortin, and Thomas Lemieux. 2009. “Unconditional Quantile Regressions.” <em>Econometrica</em> 77 (3). Wiley Online Library: 953–73.</p>
</div>
<div>
<p>Firpo, Sergio, Nicole Fortin, and Thomas Lemieux. 2018. “Decomposing Wage Distributions Using Recentered Influence Function Regressions.” <em>Econometrics</em> 6 (2). Multidisciplinary Digital Publishing Institute: 28.</p>
</div>
<div>
<p>Hlavac, Marek. 2018. <em>Stargazer: Well-Formatted Regression and Summary Statistics Tables</em>. <a href="https://CRAN.R-project.org/package=stargazer" class="uri">https://CRAN.R-project.org/package=stargazer</a>.</p>
</div>
<div>
<p>Koenker, Roger, and Kevin F Hallock. 2001. “Quantile Regression.” <em>Journal of Economic Perspectives</em> 15 (4): 143–56.</p>
</div>
<div>
<p>Machado, José AF, and José Mata. 2005. “Counterfactual Decomposition of Changes in Wage Distributions Using Quantile Regression.” <em>Journal of Applied Econometrics</em> 20 (4). Wiley Online Library: 445–65.</p>
</div>
<div>
<p>Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, and Hiroaki Yutani. 2019. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>. <a href="https://CRAN.R-project.org/package=ggplot2" class="uri">https://CRAN.R-project.org/package=ggplot2</a>.</p>
</div>
<div>
<p>Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2018. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
</div>
</div>
</div>

<br>
<div class = rmdreview>
This book is in <b><a href="open.html#open">Open Review</a></b>. I want your feedback to make the book better for you and other readers. To add your annotation, <span style="background-color: #3297FD; color: white">select some text</span> and then click the <i class="h-icon-annotate"></i> on the pop-up menu. To see the annotations of others, click the <i class="h-icon-chevron-left"></i> in the upper right hand corner of the page <i class="fa fa-arrow-circle-right  fa-rotate-315" aria-hidden="true"></i>
</div>
<br>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["Material.pdf", "Material.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
